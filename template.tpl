___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Mapp Intelligence",
  "categories": [
    "ANALYTICS",
    "CONVERSIONS",
    "MARKETING"
  ],
  "brand": {
    "displayName": "mapp-digital",
    "id": "github.com_mapp-digital",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Sends track requests to the Intelligence analytics software.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "trackId",
    "displayName": "Track ID",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "notSetText": "Enter your Mapp Intelligence Track ID",
    "help": "Enter your Mapp Intelligence Track ID here. If you want to send the same information to several accounts, simply enter the corresponding Track IDs separated by a comma. You find it at \"Mapp Intelligence Q3 \u003e Configuration \u003e System Configuration \u003e Data Collection \u003e Your Track ID\""
  },
  {
    "type": "TEXT",
    "name": "trackDomain",
    "displayName": "Track domain",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^(?!http).+"
        ]
      }
    ],
    "help": "Enter the domain to which you want the data to be sent. If you are using a Mapp Intelligence Track Domain, you should have received an email containing this Domain, among other information regarding the setup.",
    "alwaysInSummary": true,
    "valueHint": "data.mapp.com",
    "notSetText": "Enter your trackdomain without https"
  },
  {
    "type": "TEXT",
    "name": "domain",
    "displayName": "Domains excluded from referrer",
    "simpleValueType": true,
    "help": "List of domains that shall be treated as internal referrers (for example your page domain and payment providers). Do not include http or https.\u003c/br\u003e\nMap this field to a semicolon-separated list of domains, for example:\u003c/br\u003e\n\"abc.com;my-domain.de;paypal.com\"\u003c/br\u003e\nYou can also map this field to an array of strings: \u003c/br\u003e\n[ \"abc.com\", \"my-domain.de\" , \"paypal.com\" ]"
  },
  {
    "type": "TEXT",
    "name": "referrer",
    "displayName": "Referrer",
    "simpleValueType": true,
    "help": "Map this field to the value that can be found under \u0027document.referrer\u0027 in the browser."
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Debug mode",
    "simpleValueType": true
  },
  {
    "type": "GROUP",
    "name": "deviceGroup",
    "displayName": "Device",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "ipAddress",
        "displayName": "IP address",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "userAgent",
        "displayName": "User agent",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "clientHints",
        "displayName": "Client hints",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "X-WT-SEC-CH-UA",
                "displayValue": "sec-ch-ua"
              },
              {
                "value": "X-WT-SEC-CH-UA-MOBILE",
                "displayValue": "sec-ch-ua-mobile"
              },
              {
                "value": "X-WT-SEC-CH-UA-PLATFORM",
                "displayValue": "sec-ch-ua-platform"
              },
              {
                "value": "X-WT-SEC-CH-UA-FULL-VERSION-LIST",
                "displayValue": "sec-ch-ua-full-version-list"
              },
              {
                "value": "X-WT-SEC-CH-UA-MODEL",
                "displayValue": "sec-ch-ua-model"
              },
              {
                "value": "X-WT-SEC-CH-UA-PLATFORM-VERSION",
                "displayValue": "sec-ch-ua-platform-version"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add client hint"
      },
      {
        "type": "TEXT",
        "name": "displayX",
        "displayName": "Display size: width",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "displayY",
        "displayName": "Display size: height",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "displayVisibleX",
        "displayName": "Display visible: width",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "displayVisibleY",
        "displayName": "Display visible: height",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "colorDepth",
        "displayName": "Color depth",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "jsActivated",
        "displayName": "JavaScript activated",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "la",
        "displayName": "Country Code of Device Language (like \u0027en\u0027 or \u0027de\u0027)",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "tb",
        "displayName": "Tab Browsing",
        "simpleValueType": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "pageGroup",
    "displayName": "Page",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "pageName",
        "displayName": "Pagename",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "pageUrl",
        "displayName": "Page URL",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "Cp",
        "displayName": "Predefined page parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": 771,
                "displayValue": "numberSearchResults"
              },
              {
                "value": 772,
                "displayValue": "errorMessages"
              },
              {
                "value": 773,
                "displayValue": "paywall"
              },
              {
                "value": 774,
                "displayValue": "articleTitle"
              },
              {
                "value": 775,
                "displayValue": "contentTags"
              },
              {
                "value": 776,
                "displayValue": "pageTitle"
              },
              {
                "value": 777,
                "displayValue": "pageType"
              },
              {
                "value": 778,
                "displayValue": "pageLength"
              },
              {
                "value": 779,
                "displayValue": "daysSincePublication"
              }
            ],
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add predefined page parameter"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "cp",
        "displayName": "Custom page parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter ID",
            "name": "parameter",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "valueHint": "e.g. 1 if parameter is cp1"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add custom page parameter"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "cg",
        "displayName": "Page category",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Category ID",
            "name": "parameter",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "isUnique": true,
            "valueHint": "e.g. 1 if category is cg1"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add page category"
      },
      {
        "type": "TEXT",
        "name": "is",
        "displayName": "Search Results",
        "simpleValueType": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "sessionGroup",
    "displayName": "Session",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "fpv",
        "displayName": "Temporary session ID",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "Cs",
        "displayName": "Predefined session parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": 800,
                "displayValue": "loginStatus"
              },
              {
                "value": 803,
                "displayValue": "Adblocker"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add predefined session parameter"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "cs",
        "displayName": "Custom session parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter ID",
            "name": "parameter",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "valueHint": "e.g. 1 if parameter is cs1"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add custom session parameter"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "ecommerceGroup",
    "displayName": "E-commerce",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "cr",
        "displayName": "Currency",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "Cb",
        "displayName": "Predefined e-commerce parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": 560,
                "displayValue": "New or Returning Customer"
              },
              {
                "value": 561,
                "displayValue": "Return Value"
              },
              {
                "value": 562,
                "displayValue": "Cancellation Value"
              },
              {
                "value": 563,
                "displayValue": "Coupon Value"
              },
              {
                "value": 675,
                "displayValue": "Product Advertised"
              },
              {
                "value": 760,
                "displayValue": "Product Sold Out"
              },
              {
                "value": 761,
                "displayValue": "Payment Method"
              },
              {
                "value": 762,
                "displayValue": "Shipping service provider"
              },
              {
                "value": 763,
                "displayValue": "Shipping Speed"
              },
              {
                "value": 764,
                "displayValue": "Shipping Costs"
              },
              {
                "value": 765,
                "displayValue": "Gross Margin"
              },
              {
                "value": 766,
                "displayValue": "Order Status"
              },
              {
                "value": 767,
                "displayValue": "Product Variant"
              }
            ],
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add predefined e-commerce parameter"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "cb",
        "displayName": "Custom e-commerce parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter ID",
            "name": "parameter",
            "type": "TEXT",
            "valueHint": "e.g. 1 if parameter is cb1",
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add custom e-commerce parameter"
      },
      {
        "type": "GROUP",
        "name": "productGroup",
        "displayName": "Product",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "CHECKBOX",
            "name": "productTrackFromArray",
            "checkboxText": "Track Product Data from Array",
            "simpleValueType": true,
            "defaultValue": true
          },
          {
            "type": "TEXT",
            "name": "productArray",
            "displayName": "Product array",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "TEXT",
            "name": "st",
            "displayName": "Product status",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "ba",
            "displayName": "Product ID",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": false,
                "type": "EQUALS"
              }
            ],
            "help": "Map the value of the product ID"
          },
          {
            "type": "TEXT",
            "name": "co",
            "displayName": "Product cost",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": false,
                "type": "EQUALS"
              }
            ],
            "help": "Map the value of the product cost"
          },
          {
            "type": "TEXT",
            "name": "qn",
            "displayName": "Product quantity",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": false,
                "type": "EQUALS"
              }
            ],
            "help": "Map the value of the product quantity"
          },
          {
            "type": "TEXT",
            "name": "productIds",
            "displayName": "Product IDs",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "help": "Enter the name of the key in your product objects that holds the product ID"
          },
          {
            "type": "TEXT",
            "name": "productCosts",
            "displayName": "Product price",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "help": "Enter the name of the key in your product objects that holds the product price"
          },
          {
            "type": "TEXT",
            "name": "productQuantities",
            "displayName": "Product quantities",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "help": "Enter the name of the key in your product objects that holds the product quantity"
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "Ca",
            "displayName": "Predefined product categories",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Category",
                "name": "parameter",
                "type": "SELECT",
                "selectItems": [
                  {
                    "value": 870,
                    "displayValue": "Product name"
                  },
                  {
                    "value": 871,
                    "displayValue": "Product main category"
                  },
                  {
                    "value": 872,
                    "displayValue": "Product subcategory"
                  },
                  {
                    "value": 873,
                    "displayValue": "Product manufacturer/brand"
                  },
                  {
                    "value": 874,
                    "displayValue": "Product description short"
                  },
                  {
                    "value": 875,
                    "displayValue": "Product description long"
                  }
                ],
                "isUnique": true,
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": false,
                "type": "EQUALS"
              }
            ],
            "newRowButtonText": "Add predefined product category"
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "ca",
            "displayName": "Custom product categories",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Category ID",
                "name": "parameter",
                "type": "TEXT",
                "isUnique": true,
                "valueValidators": [
                  {
                    "type": "POSITIVE_NUMBER"
                  }
                ],
                "valueHint": "e.g. 1 if parameter is ca1"
              },
              {
                "defaultValue": "",
                "displayName": "Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": false,
                "type": "EQUALS"
              }
            ],
            "newRowButtonText": "Add custom product category"
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "productPredefinedRemap",
            "displayName": "Remap table for predefined product categories",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Mapp predefined product category",
                "name": "mappKey",
                "type": "SELECT",
                "selectItems": [
                  {
                    "value": 870,
                    "displayValue": "Product name"
                  },
                  {
                    "value": 871,
                    "displayValue": "Product main category"
                  },
                  {
                    "value": 872,
                    "displayValue": "Product subcategory"
                  },
                  {
                    "value": 873,
                    "displayValue": "Product manufacturer/brand"
                  },
                  {
                    "value": 874,
                    "displayValue": "Product description short"
                  },
                  {
                    "value": 875,
                    "displayValue": "Product description long"
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Object key in array",
                "name": "originalKey",
                "type": "TEXT"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "newRowButtonText": "Add remap condition"
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "productCustomRemap",
            "displayName": "Remap table for custom product categories",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Mapp custom product category ID",
                "name": "mappKey",
                "type": "TEXT",
                "selectItems": [],
                "isUnique": true,
                "valueValidators": [
                  {
                    "type": "POSITIVE_NUMBER"
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Object key in array",
                "name": "originalKey",
                "type": "TEXT"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "newRowButtonText": "Add remap condition"
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "productEcommerceRemap",
            "displayName": "Remap table for custom e-commerce parameter",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Mapp custom e-commerce parameter ID",
                "name": "mappKey",
                "type": "TEXT",
                "selectItems": [],
                "isUnique": true,
                "valueValidators": [
                  {
                    "type": "POSITIVE_NUMBER"
                  }
                ]
              },
              {
                "defaultValue": "",
                "displayName": "Object key in array",
                "name": "originalKey",
                "type": "TEXT"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "productTrackFromArray",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "newRowButtonText": "Add remap condition"
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "orderGroup",
        "displayName": "Order",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "TEXT",
            "name": "oi",
            "displayName": "Order ID",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "ov",
            "displayName": "Order Value",
            "simpleValueType": true
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "userGroup",
    "displayName": "User",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "GROUP",
        "name": "eidGroup",
        "displayName": "Ever ID (eid)",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "LABEL",
            "name": "eidHint",
            "displayName": "You can either set the eid yourself completely, or you can set a cookie to save and restore the eid.\u003c/br\u003e\nIn case you send data from a browser (for example with GA4 GTM tag), a cookie (\"wtstp_eid\", which is used by Mapp Smartpixel) can be used to to save and restore the eid - however: the server side tag needs to be on a subdomain of your page, otherwise you would have a third party cookie which will be blocked by most browsers. More info here: \u003ca href\u003d\"https://developers.google.com/tag-platform/tag-manager/server-side/custom-domain\" target\u003d\"_blank\"\u003elink\u003c/a\u003e.\u003c/br\u003e\nIf you map \"No Cookie\" to boolean true, no eid will be attached to the track request and no cookie will be read and written."
          },
          {
            "type": "TEXT",
            "name": "cookieName",
            "displayName": "Eid cookie name",
            "simpleValueType": true,
            "defaultValue": "wtstp_eid",
            "help": ""
          },
          {
            "type": "TEXT",
            "name": "eid",
            "displayName": "Ever ID (eid)",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "noCookie",
            "displayName": "No cookie",
            "simpleValueType": true
          },
          {
            "type": "GROUP",
            "name": "cookieOptionsGroup",
            "displayName": "Cookie options",
            "groupStyle": "ZIPPY_CLOSED",
            "subParams": [
              {
                "type": "LABEL",
                "name": "cookieOptionsHint",
                "displayName": "Hint: cookies only work if your server side tag runs on a subdomain of your page. More info here: \u003ca href\u003d\"https://developers.google.com/tag-platform/tag-manager/server-side/custom-domain\" target\u003d\"_blank\"\u003elink\u003c/a\u003e"
              },
              {
                "type": "TEXT",
                "name": "cookieMaxAge",
                "displayName": "Max-age",
                "simpleValueType": true,
                "defaultValue": 31536000,
                "valueValidators": [
                  {
                    "type": "NUMBER"
                  }
                ]
              },
              {
                "type": "TEXT",
                "name": "cookieDomain",
                "displayName": "Domain",
                "simpleValueType": true,
                "defaultValue": "auto"
              },
              {
                "type": "TEXT",
                "name": "cookiePath",
                "displayName": "Path",
                "simpleValueType": true,
                "defaultValue": "/"
              },
              {
                "type": "CHECKBOX",
                "name": "cookieHttpOnly",
                "checkboxText": "httpOnly",
                "simpleValueType": true,
                "defaultValue": false
              },
              {
                "type": "CHECKBOX",
                "name": "cookieSecure",
                "checkboxText": "Secure",
                "simpleValueType": true,
                "defaultValue": true
              },
              {
                "type": "SELECT",
                "name": "cookieSameSite",
                "displayName": "sameSite",
                "macrosInSelect": false,
                "selectItems": [
                  {
                    "value": "Strict",
                    "displayValue": "Strict"
                  },
                  {
                    "value": "Lax",
                    "displayValue": "Lax"
                  },
                  {
                    "value": "None",
                    "displayValue": "None"
                  }
                ],
                "simpleValueType": true,
                "defaultValue": "Lax"
              }
            ]
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "cd",
        "displayName": "Customer ID, URM - Custom visitor ID",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "Uc",
        "displayName": "Predefined URM parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": 700,
                "displayValue": "URM - e-mail"
              },
              {
                "value": 702,
                "displayValue": "URM - e-mail optin"
              },
              {
                "value": 703,
                "displayValue": "URM - gender"
              },
              {
                "value": 704,
                "displayValue": "URM - birthday"
              },
              {
                "value": 713,
                "displayValue": "URM - data validated"
              }
            ],
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add predefined URM parameter"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "uc",
        "displayName": "Custom URM parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter ID",
            "name": "parameter",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "valueHint": "e.g. 1 if category is cg1"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add custom URM parameter"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "campaignGroup",
    "displayName": "Campaign",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "mc",
        "displayName": "Campaign ID",
        "simpleValueType": true,
        "help": "You can map a campaign ID here. It consists of a mediacode and a value, joined via %3D. Example:\u003c/br\u003e\n\"wt_mc%3Den.internal.newsletter.2017.05\""
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "cc",
        "displayName": "Campaign parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter ID",
            "name": "parameter",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "valueHint": "e.g. 1 if parameter is cc1"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "eventGroup",
    "displayName": "Event",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "ct",
        "displayName": "Event name",
        "simpleValueType": true
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "Ck",
        "displayName": "Predefined event parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter",
            "name": "parameter",
            "type": "SELECT",
            "selectItems": [
              {
                "value": 500,
                "displayValue": "Survey - Survey title"
              },
              {
                "value": 501,
                "displayValue": "Survey - question"
              },
              {
                "value": 502,
                "displayValue": "Survey - question evaluation"
              },
              {
                "value": 503,
                "displayValue": "Survey - completed status"
              },
              {
                "value": 520,
                "displayValue": "Teaser - placement"
              },
              {
                "value": 521,
                "displayValue": "Teaser - name"
              },
              {
                "value": 522,
                "displayValue": "Teaser - variant"
              },
              {
                "value": 523,
                "displayValue": "Teaser - views"
              },
              {
                "value": 524,
                "displayValue": "Teaser - clicks"
              },
              {
                "value": 525,
                "displayValue": "Teaser - page engagement"
              },
              {
                "value": 526,
                "displayValue": "Teaser - content"
              },
              {
                "value": 527,
                "displayValue": "Teaser - type"
              },
              {
                "value": 529,
                "displayValue": "Teaser - widget request ID"
              },
              {
                "value": 530,
                "displayValue": "Teaser - target group"
              },
              {
                "value": 531,
                "displayValue": "Teaser - rule"
              },
              {
                "value": 532,
                "displayValue": "Teaser - item page in widget"
              },
              {
                "value": 533,
                "displayValue": "Teaser - item position in widget"
              },
              {
                "value": 540,
                "displayValue": "Scroll depth"
              },
              {
                "value": 921,
                "displayValue": "Content engagement - name"
              },
              {
                "value": 922,
                "displayValue": "Content engagement - element visibility % figure"
              },
              {
                "value": 923,
                "displayValue": "Content engagement - element visibility % text"
              }
            ],
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add predefined event parameter"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "ck",
        "displayName": "Custom event parameter",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter ID",
            "name": "parameter",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add custom event parameter"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const encodeUriComponent = require('encodeUriComponent');
const encodeUri = require('encodeUri');
const generateRandom = require('generateRandom');
const getCookieValues = require('getCookieValues');
const getEventData = require('getEventData');
const logToConsole = require('logToConsole');
const makeNumber = require('makeNumber');
const makeString = require('makeString');
const sendHttpGet = require('sendHttpGet');
const setCookie = require('setCookie');
const getType = require('getType');
const getTimestampMillis = require('getTimestampMillis');
const parseUrl = require('parseUrl');
const log = data.debug ? logToConsole : () => {};
const shallExecute = () => {
  const mandatory = ["trackId", "trackDomain"];
  for (let i = 0; i < mandatory.length; i++) {
    if(!data[mandatory[i]]) {
      log("Can't send request: missing " + mandatory[i]);
      return false;
    }	
  }
  return true;
};

if(shallExecute()) {
  const addParam = (para, value) => {trackRequest += "&" + para + "=" + encodeUriComponent(value);};
  const isNotLastEntry = (i, a, fun) => {if(i !== a.length -1) fun();};
  const time = data.timestamp || getTimestampMillis();
  const pageName = data.pageName || getEventData('page_location') || "no pageName";
  const pageUrl = data.pageUrl || getEventData('page_location') || null;
  let trackRequest = "https://" + encodeUri(data.trackDomain) + "/" + encodeUri(data.trackId) + "/wt?";

  // P parameter
  const getP = () => {
    const gr = (x, y) => (x && y) ? x + "x" + y : "";
    const g = (p) => data[p] ? data[p] : "";
    const ref = (()=>{
      const r = parseUrl(data.referrer);
      if(!r) {
        return "0";
      }
      let d = [];
      switch(getType(data.domain)) {
        case "string": d = data.domain.split(";");break;
        case "array": d = data.domain;break;
        default: break;
      }
      return d.indexOf(r.hostname) === -1 ? encodeUriComponent(data.referrer) : "1";
    })();
    const res = getEventData("screen_resolution") || gr(data.displayX, data.displayY);
    const cookies = data.noCookie === true ? "0" : "1";
    
    return ["p=350", encodeUriComponent(pageName), g("jsActivated"), res, g("colorDepth"), cookies, time, ref, gr(data.displayVisibleX, data.displayVisibleY)].join(",");
  };

  trackRequest += getP();
  
  // IP and User Agent
  const ip = data.ipAddress || getEventData('ip_override') || null;
  if(ip) {
    addParam("X-WT-IP", ip);
  }
  const ua = data.userAgent || getEventData('user_agent') || null;
  if(ua) {
    addParam("X-WT-UA", ua);
  }
  
  // EID
  if(data.noCookie === true) {
    addParam("nc", "1");
  } else if(data.eid){
    addParam("eid", data.eid);
  } else {
    const newEid = () => "8" + time + generateRandom(10000, 99999);
    const n = data.cookieName || "wtstp_eid";
    const eid = getCookieValues(n)[0] || newEid();
    const options = {
      'max-age': data.hasOwnProperty("cookieMaxAge") ? makeNumber(data.cookieMaxAge) : 3600 * 24 * 365,
      domain: data.cookieDomain || 'auto',
      path: data.cookiePath || '/',
      httpOnly: data.cookieHttpOnly,
      secure: data.cookieSecure,
      sameSite: data.cookieSameSite
    };
    addParam("eid", eid);
    setCookie(n, eid, options);
  }
  
  // parameter data
  const dataSingle = ["ct", "st", "oi", "ov", "cd", "cr", "is", "mc", "la", "fpv", "tb"];
  const dataGroups = ["cg", "Cp", "cp", "Cs", "cs", "Cb", "cb", "Uc", "uc", "Ck", "ck", "cc"];
  const buildParams = (input, urlKey) => {
    input.forEach((trackData) => {
      addParam(urlKey + trackData.parameter, trackData.value);
    });
  };

  if(data.productTrackFromArray && getType(data.productArray) === "array") {
    // product array
    const mappings = [
      [data.productIds, "ba"], [data.productCosts, "co"], [data.productQuantities, "qn"]
    ];
    ["productPredefinedRemap", "productCustomRemap", "productEcommerceRemap"].forEach((r) =>{
      if(data.hasOwnProperty(r)) {
        const p = r === "productEcommerceRemap" ? "cb" : "ca";
        data[r].forEach(rp => {
          mappings.push([rp.originalKey, p + rp.mappKey]);
        });
      }
    });
    mappings.forEach((mp) => {
      let vl = "";
      data.productArray.forEach((v, i, a) => {
        vl += getType(v[mp[0]]) === "undefined" ? "" : v[mp[0]];
        isNotLastEntry(i, a, ()=>{vl += ';';});
      });
      addParam(mp[1], vl);
    });
  } else {
    // non-array product tracking
    dataSingle.push("ba", "co", "qn");
    dataGroups.push("Ca","ca");
  }

  dataSingle.forEach(d=>{if(data.hasOwnProperty(d))addParam(d, data[d]);});
  dataGroups.forEach(d=>{if(data[d]) buildParams(data[d], d.toLowerCase());});

  // clientHints
  if(data.hasOwnProperty("clientHints")) {
    data.clientHints.forEach((hint) => {
      switch(getType(hint.value)) {
        case "boolean":
          addParam(hint.parameter, hint.value ? "?1" : "?0");
          break;
        case "array":
          let fvl = "";
          hint.value.forEach((v, i, a) => {
            if(v.brand && v.version) {
              fvl += '"' + v.brand + '";v="' + v.version + '"';
              isNotLastEntry(i, a, ()=>{fvl += ', ';});
            } 
          });
          addParam(hint.parameter, fvl);
          break;
        case "string":
        default:
          addParam(hint.parameter, hint.value);
      }
    });
  }
  
  // statistics
  addParam("cs801","1.0.0");addParam("cs802", "gtm");
  addParam("pf", (()=>{let r = 0; if(data.cookieSecure) r+= 512; if(data.noCookie) r+=1024;return r;}()));
  
  // pu
  if(pageUrl) addParam("pu", pageUrl);

  log("data: ", data);
  log("trackrequest: ", trackRequest);

  sendHttpGet(trackRequest).then((result) => {
    if (result.statusCode >= 200 && result.statusCode < 300) {
      log("trackrequest sent successfully");
      data.gtmOnSuccess();
    } else {
      log("failed to send trackrequest");
      data.gtmOnFailure();
    }
  }).catch((e) => {
      log("error", e);
      data.gtmOnFailure();
  });
} else {
  data.gtmOnFailure();
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: No trackId
  code: |
    const mockData = {
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasNotCalled();
- name: No trackDomain
  code: |
    const mockData = {
      trackId: "136699033798929",
      timestamp: "1684232116378",
      debug: true,
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasNotCalled();
- name: TrackId, Trackdomain, pu
  code: |-
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,,,,0,1684232116378,0,&nc=1&cs801=1.0.0&cs802=gtm&pf=1024&pu=https%3A%2F%2Fabc.de");
- name: P parameter - with referrer
  code: |-
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      jsActivated: "1",
      domain: "",
      referrer: "https://cdf.com",
      displayX: "1920",
      displayY: "1080",
      displayVisibleX: "99",
      displayVisibleY: "22",
      colorDepth: "24",
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,1,1920x1080,24,0,1684232116378,https%3A%2F%2Fcdf.com,99x22&nc=1&cs801=1.0.0&cs802=gtm&pf=1024&pu=https%3A%2F%2Fabc.de");
- name: Referrer in domain array
  code: |-
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      jsActivated: "1",
      domain: ["abc.de","cdf.com","zgf.xy"],
      referrer: "https://cdf.com",
      displayX: "1920",
      displayY: "1080",
      displayVisibleX: "99",
      displayVisibleY: "22",
      colorDepth: "24",
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,1,1920x1080,24,0,1684232116378,1,99x22&nc=1&cs801=1.0.0&cs802=gtm&pf=1024&pu=https%3A%2F%2Fabc.de");
- name: Referrer in domain string
  code: |-
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      jsActivated: "1",
      domain: "abc.de;cdf.com;zgf.xy",
      referrer: "https://cdf.com",
      displayX: "1920",
      displayY: "1080",
      displayVisibleX: "99",
      displayVisibleY: "22",
      colorDepth: "24",
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,1,1920x1080,24,0,1684232116378,1,99x22&nc=1&cs801=1.0.0&cs802=gtm&pf=1024&pu=https%3A%2F%2Fabc.de");
- name: Referrer not in domain array
  code: |-
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      jsActivated: "1",
      domain: ["abc.de","cd.com","zgf.xy"],
      referrer: "https://cdf.com",
      displayX: "1920",
      displayY: "1080",
      displayVisibleX: "99",
      displayVisibleY: "22",
      colorDepth: "24",
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,1,1920x1080,24,0,1684232116378,https%3A%2F%2Fcdf.com,99x22&nc=1&cs801=1.0.0&cs802=gtm&pf=1024&pu=https%3A%2F%2Fabc.de");
- name: Referrer not in domain string
  code: |-
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      jsActivated: "1",
      domain: "abc.de;cd.com;zgf.xy",
      referrer: "https://cdf.com",
      displayX: "1920",
      displayY: "1080",
      displayVisibleX: "99",
      displayVisibleY: "22",
      colorDepth: "24",
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,1,1920x1080,24,0,1684232116378,https%3A%2F%2Fcdf.com,99x22&nc=1&cs801=1.0.0&cs802=gtm&pf=1024&pu=https%3A%2F%2Fabc.de");
- name: Invalid url in referrer
  code: |-
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      jsActivated: "1",
      domain: "abc.de;cd.com;zgf.xy",
      referrer: "abc",
      displayX: "1920",
      displayY: "1080",
      displayVisibleX: "99",
      displayVisibleY: "22",
      colorDepth: "24",
      noCookie: true,
      pageName: "testpage",
      pageUrl: "https://abc.de"
    };

    // Call runCode to run the template's code.
    runCode(mockData);
    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,1,1920x1080,24,0,1684232116378,0,99x22&nc=1&cs801=1.0.0&cs802=gtm&pf=1024&pu=https%3A%2F%2Fabc.de");
- name: SingleData
  code: "const mockData = {\n  trackId: \"136699033798929\",\n  trackDomain: \"data.mapp.com\"\
    ,\n  timestamp: \"1684232116378\",\n  debug: true,\n  noCookie: true,\n  pageName:\
    \ \"testpage\",\n  ct: \"testevent\",\n  st: \"conf\",\n  oi: \"12345\",\n  ov:\
    \ \"99.99\",\n  cd: \"testname\",\n  cr: \"EUR\" \n};\n// Call runCode to run\
    \ the template's code.\nrunCode(mockData);\n\nassertApi('sendHttpGet').wasCalled();\n\
    assertApi('sendHttpGet').wasCalledWith(\"https://data.mapp.com/136699033798929/wt?p=350,testpage,,,,0,1684232116378,0,&nc=1&ct=testevent&st=conf&oi=12345&ov=99.99&cd=testname&cr=EUR&cs801=1.0.0&cs802=gtm&pf=1024\"\
    );\n\n"
- name: DataGroups
  code: |+
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      noCookie: true,
      pageName: "testpage",
      cg:[
        {parameter:"1",value: "pcat1"}, {parameter: "99",value: "pgat99"}
      ],
      Cp:[
        {parameter: 771, value: "123"}, {parameter:774, value: "artic title"}
      ],
      cp:[
        {parameter: "6", value: "para6"}
      ]
    };
    // Call runCode to run the template's code.
    runCode(mockData);

    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,,,,0,1684232116378,0,&nc=1&cg1=pcat1&cg99=pgat99&cp771=123&cp774=artic%20title&cp6=para6&cs801=1.0.0&cs802=gtm&pf=1024");

- name: Client Hints
  code: "const mockData = {\n  trackId: \"136699033798929\",\n  trackDomain: \"data.mapp.com\"\
    ,\n  timestamp: \"1684232116378\",\n  debug: true,\n  noCookie: true,\n  pageName:\
    \ \"testpage\",\n  clientHints: [\n    {parameter:\"X-WT-SEC-CH-UA-FULL-VERSION-LIST\"\
    , value: [\n      {brand: \"Google Chrome\", version: \"111.0.5563.146\"},\n \
    \     {brand: \"Not(A:Brand\", version: \"8.0.0.0\"},\n      {brand: \"Chromium\"\
    , version: \"111.0.5563.146\"}\n    ]},\n    {parameter: \"X-WT-SEC-CH-UA\", value:\
    \ [\n      {brand: \"Google Chrome\", version: \"111\"},\n      {brand: \"Not(A:Brand\"\
    , version: \"8\"},\n      {brand: \"Chromium\", version: \"111\"}\n    ]},\n \
    \   {parameter: \"X-WT-SEC-CH-UA-MOBILE\", value: false},\n    {parameter: \"\
    X-WT-SEC-CH-UA-PLATFORM\", value: \"Linux\"},\n    {parameter: \"X-WT-SEC-CH-UA-MODEL\"\
    , value: \"\"},\n    {parameter: \"X-WT-SEC-CH-UA-PLATFORM-VERSION\", value: \"\
    5.15.0\"}\n  ]\n \n};\n\nrunCode(mockData);\n\nassertApi('sendHttpGet').wasCalled();\n\
    assertApi('sendHttpGet').wasCalledWith(\"https://data.mapp.com/136699033798929/wt?p=350,testpage,,,,0,1684232116378,0,&nc=1&X-WT-SEC-CH-UA-FULL-VERSION-LIST=%22Google%20Chrome%22%3Bv%3D%22111.0.5563.146%22%2C%20%22Not(A%3ABrand%22%3Bv%3D%228.0.0.0%22%2C%20%22Chromium%22%3Bv%3D%22111.0.5563.146%22&X-WT-SEC-CH-UA=%22Google%20Chrome%22%3Bv%3D%22111%22%2C%20%22Not(A%3ABrand%22%3Bv%3D%228%22%2C%20%22Chromium%22%3Bv%3D%22111%22&X-WT-SEC-CH-UA-MOBILE=%3F0&X-WT-SEC-CH-UA-PLATFORM=Linux&X-WT-SEC-CH-UA-MODEL=&X-WT-SEC-CH-UA-PLATFORM-VERSION=5.15.0&cs801=1.0.0&cs802=gtm&pf=1024\"\
    );"
- name: Product array
  code: |-
    const mockData = {
      trackId: "136699033798929",
      trackDomain: "data.mapp.com",
      timestamp: "1684232116378",
      debug: true,
      noCookie: true,
      pageName: "testpage",
      productTrackFromArray: true,
      productArray: [
       {
        item_id: "SKU2",
        item_name: "Stan and Friends Tee",
        item_category: "cat999",
        price: 9.99,
        quantity: 3
       },
       {
        item_id: "SKU1",
        item_name: "Google Grey Women's Tee",
        item_category: "Cat1",
        price: 20.99,
        quantity: 7
       }
      ],
      st: "add",
      productIds: "item_name",
      productQuantities: "quantity",
      productCosts: "price",
      productPredefinedRemap: [
        {mappKey: "871", originalKey: "item_category"}
      ],
      productEcommerceRemap: [
        {mappKey: "33", originalKey: "item_id"},
        {mappKey: "12", originalKey: "item_category"}
      ]
    };

    runCode(mockData);

    assertApi('sendHttpGet').wasCalled();
    assertApi('sendHttpGet').wasCalledWith("https://data.mapp.com/136699033798929/wt?p=350,testpage,,,,0,1684232116378,0,&nc=1&ba=Stan%20and%20Friends%20Tee%3BGoogle%20Grey%20Women's%20Tee&co=9.99%3B20.99&qn=3%3B7&ca871=cat999%3BCat1&cb33=SKU2%3BSKU1&cb12=cat999%3BCat1&st=add&cs801=1.0.0&cs802=gtm&pf=1024");
setup: ''


___NOTES___

Created on 5/16/2023, 1:00:55 PM


